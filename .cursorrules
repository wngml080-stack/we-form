# We:form 개발 규칙
# 최종 업데이트: 2025-12-31
# 상세 명세: PRD.md 참조 | DB 스키마: ERD.md 참조

---

## 0. 협업 수칙

- **Critical Preservation**: 기존 기능 삭제/변경 시 반드시 사이드 이펙트 경고 및 동의 구할 것
- **Proactive Suggestion**: 더 효율적이거나 안전한 아키텍처가 있다면 즉시 제안
- **Full Context**: 코드 수정 시 전체 파일 코드 제공을 기본으로
- **Error Handling**: 에러 발생 시 console.log 추가하여 원인 파악 코드 먼저 제안

---

## 1. 프로젝트 개요

**We:form** - 피트니스 센터(헬스장/필라테스/PT 센터)를 위한 멀티테넌시 ERP SaaS

### 핵심 가치
- **멀티테넌시**: Company → Gym 구조로 데이터 격리
- **역할 기반 접근 제어**: system_admin / company_admin / admin / staff 4단계
- **통합 관리**: 회원, 스케줄, 출석, 급여, 매출을 하나의 플랫폼에서 관리

---

## 2. 기술 스택

| 영역 | 기술 |
|------|------|
| Frontend | Next.js 16, TypeScript, Tailwind CSS 4, shadcn/ui |
| Backend | Next.js API Routes, Supabase (PostgreSQL) |
| 인증 | Supabase Auth |
| 보안 | Row Level Security (RLS) |
| 배포 | Vercel |

---

## 3. 브랜드 & 디자인

- **Brand Name**: We:form
- **Primary Color**: Bright Blue `#2F80ED`
- **Accent Color**: Orange `#F2994A`
- **Style**: Clean, Minimal, Data-Centric
- **UI Library**: shadcn/ui + Tailwind CSS 4

### 디자인 원칙
- **모바일 우선**: `/staff/*` 화면은 모바일 해상도 기준 설계
- **데이터 우선**: 차트/카드/리스트로 한 눈에 이해 가능한 데이터 표현
- **일관된 색 사용**:
  - 메인 배경/헤더/사이드바: Primary Blue
  - CTA 버튼: Accent Orange + 흰색/진한 텍스트

---

## 4. 핵심 아키텍처 규칙

### 4-1. 멀티 테넌시
- 모든 주요 테이블에 `gym_id` 컬럼 필수
- 모든 DB 조회/수정에 `where gym_id = ?` 필터 필수
- RLS 정책으로 권한 강제

### 4-2. 라우팅
- `/login`: 진입점
- `/staff/*`: 강사용 모바일 뷰
- `/admin/*`: 관리자용 대시보드

### 4-3. 역할별 권한
| 역할 | 접근 범위 |
|------|----------|
| system_admin | 모든 회사/지점 |
| company_admin | 소속 회사의 모든 지점 |
| admin | 소속 지점만 |
| staff | 본인 데이터만 |

---

## 5. 코딩 스타일

- **함수형 컴포넌트 + Hooks**만 사용
- **RLS 우선**: SQL 설계 시 항상 Row Level Security 고려
- **비즈니스 로직 하드코딩 금지**: DB 설정 테이블로 관리
- **명시적 타입 사용**: `any` 최소화, 도메인 타입 정의
- **한국어 UX**: 에러 메시지는 한국어로, 사용자가 이해하기 쉽게

### 보안 규칙
- `staffs.employment_status === '퇴사'`면 로그아웃 처리
- `gyms.status === 'pending'`이면 로그인 차단
- Service Role 키는 서버 전용 클라이언트에서만 사용

---

## 6. 코드 품질

### 파일 길이 제한
- 모든 소스 파일은 **800줄 초과 금지**
- 초과 시 컴포넌트/훅 분리 먼저 실행

### 작업 시작 리추얼
- 즉시 코드 작성하지 않고 먼저 문맥 파악
- 수정하려는 파일을 처음부터 끝까지 분석 후 솔루션 제시
- "코드를 읽고 이해했습니다"라는 확신 전까지 수정 제안 금지

---

## 7. 참고 문서

- **PRD.md**: 제품 요구사항 및 기능 명세 (SSOT)
- **ERD.md**: 데이터베이스 구조
- **docs/DESIGN_SYSTEM.md**: 디자인 시스템 상세
- **docs/TEST_ACCOUNTS.md**: 테스트 계정 정보
- **docs/SALARY_SYSTEM_SETUP.md**: 급여 시스템 설정

---

## 8. AI 사용 정책

- 역할/권한 규칙을 항상 존중하는 방향으로 제안
- 공식 가이드(Supabase, shadcn, FullCalendar 등)와 일치하게 설정
- 서버 실행 명령은 직접 실행하도록 안내만
- 한국어를 기본 응답 언어로, 비개발자도 이해할 수 있게 쉬운 설명
